<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Using Tiled with Kaplay | Judah M </title> <meta name="author" content="Judah M "> <meta name="description" content="Using Tiled Web Map Level editor with Kaplay."> <meta name="keywords" content="backend, c++, c, haskell, java, javascript, nodejs, python, rust, typescript"> <meta property="og:site_name" content="Judah M "> <meta property="og:type" content="article"> <meta property="og:title" content="Judah M | Using Tiled with Kaplay"> <meta property="og:url" content="https://judahsan.github.io/blog/2024/tiled-kaplay/"> <meta property="og:description" content="Using Tiled Web Map Level editor with Kaplay."> <meta property="og:image" content="assets/img/profile_pic.jpg"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Using Tiled with Kaplay"> <meta name="twitter:description" content="Using Tiled Web Map Level editor with Kaplay."> <meta name="twitter:image" content="assets/img/profile_pic.jpg"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img//profile_pic.jpg?e79d8219c8359cb07b6340c15c745239"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://judahsan.github.io/blog/2024/tiled-kaplay/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class=" "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm sticky-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Judah</span> M </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">bio </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Using Tiled with Kaplay</h1> <p class="post-meta"> Created in July 18, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/level-design"> <i class="fa-solid fa-hashtag fa-sm"></i> level-design</a>     ·   <a href="/blog/category/posts"> <i class="fa-solid fa-tag fa-sm"></i> posts</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Personal notes from <a href="https://jslegenddev.substack.com/p/how-to-use-tiled-with-kaplayjs" rel="external nofollow noopener" target="_blank">JLegendDev’s blog post</a></p> <h4 id="prerequisites">Prerequisites:</h4> <ul> <li>Basic knowledge of Kaplay.js and JavaScript</li> <li> <a href="(https://www.mapeditor.org/)">Tiled</a> downloaded and installed</li> </ul> <h5 id="assets">Assets:</h5> <ul> <li>A 3 tiles wide x 3 tiles tall map. Download assets <a href="https://github.com/JSLegendDev/Zelda-like-Kaplayjs/blob/master/assets/topdownasset.png" rel="external nofollow noopener" target="_blank">here</a>.</li> <li>Bonus: The assets were used in the <a href="https://www.youtube.com/watch?v=pVAmEJqK-3A" rel="external nofollow noopener" target="_blank">Zelda-like tutorial</a> </li> </ul> <h3 id="setting-up-tiled">Setting up Tiled</h3> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/setup1-480.webp 480w,/assets/img/setup1-800.webp 800w,/assets/img/setup1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/setup1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Once Tiled is installed, open the program and create a new map like shown in the screenshot above.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/setup2-480.webp 480w,/assets/img/setup2-800.webp 800w,/assets/img/setup2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/setup2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Next, set the map size to 3 x 3 and the tile size to 16 x 16 (Since our spritesheet is designed to be tiles of 16 x 16 pixels). Make sure the “Fixed” option is the one selected. Then, click “OK”.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/setup3-480.webp 480w,/assets/img/setup3-800.webp 800w,/assets/img/setup3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/setup3.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Now we still need to add our spritesheet so we can start drawing our level. Click on “New Tileset” as shown in the screenshot above.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/setup4-480.webp 480w,/assets/img/setup4-800.webp 800w,/assets/img/setup4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/setup4.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Click on the “Browse” button and select the spritesheet image you want to use in your file explorer. Then, click “OK”.</p> <h3 id="creating-tile-layers">Creating Tile Layers</h3> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/layer-480.webp 480w,/assets/img/layer-800.webp 800w,/assets/img/layer-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/layer.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Rename the default layer named “Tile Layer 1” to “Ground” at the top-right of the editor by double clicking on the current layer name. This will make it editable allowing you to write a new name. Then at the bottom-right where you can see the spritesheet, select the grass tile and start drawing on your grid like shown in the screenshot above. Tip : You can use Ctrl + mouse wheel to zoom in and out.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/layer2-480.webp 480w,/assets/img/layer2-800.webp 800w,/assets/img/layer2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/layer2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>In Tiled, there two major types of layers you can create. The first one is the “Tile Layer” which is used for drawing tiles. The other one is the “Object Layer” and is used to set colliders (hitboxes) or spawn positions for your game entities. <br> By default, Tiled creates a “Tile Layer” as the first layer, that’s why you were able to draw on the grid previously. Now that you have drawn the ground which is composed of only grass tiles, it’s time to add a bush. <br> To do this, create a new “Tile Layer” like shown in the screenshot above and name it “Bushes”.</p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/layer3-480.webp 480w,/assets/img/layer3-800.webp 800w,/assets/img/layer3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/layer3.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Make sure this new layer is placed on top of the “Ground” layer. If not the case by default, you can drag a layer around by holding the left mouse button over the tile layer name. <br> Finally, draw a bush at the center of the grid like shown in the screenshot. Make sure before you do this to have the “Bushes” layer selected in the Layers inspector (located at the top-right). You can select a layer by clicking on its name.</p> <h3 id="creating-object-layers">Creating Object Layers</h3> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/obj-480.webp 480w,/assets/img/obj-800.webp 800w,/assets/img/obj-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/obj.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Now that we’re done with placing our tiles we need to place our colliders. Colliders are static objects that can serve as obstacles or walls in games. The appropriate layer type for this would be an “Object Layer” because we only care about the position, the height and width of the collider which isn’t possible to set in a “Tile Layer”. <br> As shown in the screenshot above, create an “Object Layer”.</p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/obj2-480.webp 480w,/assets/img/obj2-800.webp 800w,/assets/img/obj2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/obj2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Rename it to “Colliders”. Names are important because they’re used to determine what to do with each layer in our code. <br> Select the rectangle icon at the top-left of the editor (shown in the screenshot above). Draw a square on the grid by clicking and dragging it around to set its size. <br> If we had 3 bushes aligned, we would draw one long rectangle as the collider instead of 3 squares as it would be better for performance. In Kaplay.js, the more Game Objects are created the less the game remains performant so it’s important to limit the amount of colliders needed (as much as possible). <br></p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/obj3-480.webp 480w,/assets/img/obj3-800.webp 800w,/assets/img/obj3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/obj3.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>To make things easy, make sure to enable the “Snap to Grid” option before drawing the rectangle on the grid. This option will make sure the square fits the tile perfectly. It makes things less error prone. You can access this option by going to “View” &gt; “Snapping” &gt; “Snap to Grid”. This is shown in the screenshot above.</p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/obj4-480.webp 480w,/assets/img/obj4-800.webp 800w,/assets/img/obj4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/obj4.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Now, create another “Object Layer” and name it “Positions”. This layer will be used to determine where to place our player on the map. Instead of drawing a square like we did for the “Colliders” layer, select the pin icon (at the top-left of the editor) and place a pin at the top-left of the grid. This is where our player will spawn. Using the properties tab on the left, set the name of the pin to be “player”. This is useful to know in your code where to place what. For example, you could have pins named “spider”, “bear”, etc… and for each you would write code to display something different. <br> Make sure to save your map by going to “File” &gt; “Save As…”. Name the map file as “map.json” and save it to your project’s directory.</p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/obj5-480.webp 480w,/assets/img/obj5-800.webp 800w,/assets/img/obj5-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/obj5.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>In Kaplay, drawing tiles individually using k.drawSprite() calls is less efficient than using Tiled to convert our map into a single image and then displaying it within a sprite component. This might sound strange and it is. In other game libraries, it’s more efficient to draw tiles individually rather than baking them into an image. I don’t know how Kaplay implements this, I’m as puzzled as you. <br> To convert our tilemap to a single image, first, In the Layers inspector, hide the “Positions” and “Colliders” layers by clicking on the eye icons as shown in the screenshot above. <br> Then, go to “File” and click on “Export As Image”.</p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/obj6-480.webp 480w,/assets/img/obj6-800.webp 800w,/assets/img/obj6-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/obj6.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>A new menu will appear. Set the place where you want to save the image using the “Browse” button. Once done, make sure to select the option “Only include visible layers” and then click “Export”.</p> <h3 id="rendering-the-map-in-kaplay">Rendering The map in Kaplay</h3> <p>Your “map.json” contains all the data needed to to display your map in Kaplay. Not all of the data is useful, so the most important part is the “layers” property which contains an array of layers. In this project, we only created 3 layers so this array should only have three elements. <br> As your map grows in size so will this “map.json” file. That’s why I kept the map very small so I could paste the entire “map.json” file here.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"compressionlevel"</span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span><span class="w">
 </span><span class="nl">"height"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
 </span><span class="nl">"infinite"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
 </span><span class="nl">"layers"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
         </span><span class="nl">"data"</span><span class="p">:[</span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w">
            </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w">
            </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">],</span><span class="w">
         </span><span class="nl">"height"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
         </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Ground"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"opacity"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"tilelayer"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
         </span><span class="nl">"width"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
         </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="p">{</span><span class="w">
         </span><span class="nl">"data"</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">161</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span><span class="w">
         </span><span class="nl">"height"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
         </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
         </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Bushes"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"opacity"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"tilelayer"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
         </span><span class="nl">"width"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
         </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="p">{</span><span class="w">
         </span><span class="nl">"draworder"</span><span class="p">:</span><span class="s2">"topdown"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
         </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Colliders"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"objects"</span><span class="p">:[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                 </span><span class="nl">"height"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"rotation"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"width"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">16</span><span class="w">
                </span><span class="p">}],</span><span class="w">
         </span><span class="nl">"opacity"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"objectgroup"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
    
        </span><span class="p">{</span><span class="w">
         </span><span class="nl">"draworder"</span><span class="p">:</span><span class="s2">"topdown"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="w">
         </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Positions"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"objects"</span><span class="p">:[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                 </span><span class="nl">"height"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"player"</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"point"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"rotation"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"width"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="w">
                </span><span class="p">},</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                 </span><span class="nl">"height"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"player"</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"point"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"rotation"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"width"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                 </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="w">
                </span><span class="p">}],</span><span class="w">
         </span><span class="nl">"opacity"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"objectgroup"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"visible"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nl">"y"</span><span class="p">:</span><span class="mi">0</span><span class="w">
        </span><span class="p">}],</span><span class="w">
 </span><span class="nl">"nextlayerid"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w">
 </span><span class="nl">"nextobjectid"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w">
 </span><span class="nl">"orientation"</span><span class="p">:</span><span class="s2">"orthogonal"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"renderorder"</span><span class="p">:</span><span class="s2">"right-down"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"tiledversion"</span><span class="p">:</span><span class="s2">"1.10.2"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"tileheight"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
 </span><span class="nl">"tilesets"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
         </span><span class="nl">"columns"</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="w">
         </span><span class="nl">"firstgid"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
         </span><span class="nl">"image"</span><span class="p">:</span><span class="s2">"topdownasset.png"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"imageheight"</span><span class="p">:</span><span class="mi">496</span><span class="p">,</span><span class="w">
         </span><span class="nl">"imagewidth"</span><span class="p">:</span><span class="mi">624</span><span class="p">,</span><span class="w">
         </span><span class="nl">"margin"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"topdownasset"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"spacing"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nl">"tilecount"</span><span class="p">:</span><span class="mi">1209</span><span class="p">,</span><span class="w">
         </span><span class="nl">"tileheight"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
         </span><span class="nl">"tilewidth"</span><span class="p">:</span><span class="mi">16</span><span class="w">
        </span><span class="p">}],</span><span class="w">
 </span><span class="nl">"tilewidth"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
 </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"map"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"version"</span><span class="p">:</span><span class="s2">"1.10"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"width"</span><span class="p">:</span><span class="mi">3</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Assuming you know how to setup Kaplay, here is the code you need to be able to display the map.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">kaplay</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./lib/kaplay.mjs</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nf">kaplay</span><span class="p">({</span> <span class="na">global</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>

<span class="nx">k</span><span class="p">.</span><span class="nf">loadSprite</span><span class="p">(</span><span class="dl">"</span><span class="s2">spritesheet</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">./topdownasset.png</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">sliceX</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span>
  <span class="na">sliceY</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
<span class="p">});</span> <span class="c1">// this is needed for the player animations </span>
<span class="c1">// This because the tiles + player sprites are in the same image </span>
<span class="c1">// If they were separate, we wouldn't need to load the tilesheet as the exported "map.png" would be enough</span>

<span class="nx">k</span><span class="p">.</span><span class="nf">loadSprite</span><span class="p">(</span><span class="dl">"</span><span class="s2">map</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">./map.png</span><span class="dl">"</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">mapData</span> <span class="o">=</span> <span class="k">await </span><span class="p">(</span><span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">./map.json</span><span class="dl">"</span><span class="p">)).</span><span class="nf">json</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">k</span><span class="p">.</span><span class="nf">add</span><span class="p">([</span><span class="nx">k</span><span class="p">.</span><span class="nf">pos</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]);</span>
  <span class="nx">k</span><span class="p">.</span><span class="nf">camPos</span><span class="p">(</span><span class="nx">map</span><span class="p">.</span><span class="nx">pos</span><span class="p">);</span>
  <span class="nx">k</span><span class="p">.</span><span class="nf">camScale</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

  <span class="nx">map</span><span class="p">.</span><span class="nf">add</span><span class="p">([</span><span class="nx">k</span><span class="p">.</span><span class="nf">sprite</span><span class="p">(</span><span class="dl">"</span><span class="s2">map</span><span class="dl">"</span><span class="p">)]);</span>

  <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">layer</span> <span class="k">of</span> <span class="nx">mapData</span><span class="p">.</span><span class="nx">layers</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">tilelayer</span><span class="dl">"</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">Colliders</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">object</span> <span class="k">of</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">objects</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nf">add</span><span class="p">([</span>
          <span class="nx">k</span><span class="p">.</span><span class="nf">area</span><span class="p">({</span> <span class="na">shape</span><span class="p">:</span> <span class="k">new</span> <span class="nx">k</span><span class="p">.</span><span class="nc">Rect</span><span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nf">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">object</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">object</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>   <span class="p">}),</span>
          <span class="nx">k</span><span class="p">.</span><span class="nf">body</span><span class="p">({</span> <span class="na">isStatic</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}),</span>
          <span class="nx">k</span><span class="p">.</span><span class="nf">pos</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">object</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span>
        <span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">Positions</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">object</span> <span class="k">of</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">objects</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">player</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">map</span><span class="p">.</span><span class="nf">add</span><span class="p">([</span>
            <span class="nx">k</span><span class="p">.</span><span class="nf">sprite</span><span class="p">(</span><span class="dl">"</span><span class="s2">spritesheet</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">frame</span><span class="p">:</span> <span class="mi">936</span> <span class="p">}),</span> <span class="c1">// idle frame of the player sprite</span>
            <span class="nx">k</span><span class="p">.</span><span class="nf">area</span><span class="p">(),</span>
            <span class="nx">k</span><span class="p">.</span><span class="nf">pos</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">object</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span>
          <span class="p">]);</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">();</span>
</code></pre></div></div> <p>Given the code above and the content of “map.json”, you can figure out what’s going on easily. <br> However, here a few observations that will help you understand the logic further :</p> <ul> <li> <p>You get the map’s data into your Kaplay game by making a fetch() call to the “map.json” file.</p> </li> <li> <p>We create a map Game Object acting as the parent of all Game Objects placed on the map. This is important because the position coordinates provided by “map.json” are all relative to the map. So if you create a Game Object without the map being the parent, the Game Object’s placement will be off. With our map Game Object we’re able to make sure the positions of tiles and colliders match.</p> </li> <li> <p>Since we’re not drawing the map tile by tile and rather just using the exported image, it’s important to skip any “Tile Layer” in our for loop.</p> </li> </ul> <h3 id="the-results">The Results</h3> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/result-480.webp 480w,/assets/img/result-800.webp 800w,/assets/img/result-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/result.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Now if I activate the debug mode using the “f1” key, you can see that the collider for the bush is also placed correctly. If you were to write the player movement logic, the player could collide with the bush.</p> <div class="col-sm row mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/result2-480.webp 480w,/assets/img/result2-800.webp 800w,/assets/img/result2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/result2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/creating-a-build-tool-using-go/">Creating A Build Tool Using Go</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/redis/">Redis A High-Performance In-Memory Data Store</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/docker/">Dockerizing and Deploying Your App to Docker Hub</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Judah M . </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>